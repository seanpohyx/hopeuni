<!DOCTYPE html>
<html>
<head>
	<title>HopeUNI</title>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
	<link rel="stylesheet" type="text/css" href="styles/home.css">
</head>
<body>
	<div id='main' ng-app="hopeUNIapp" ng-controller="hopeUNIctrl">

		<input id = 'name-filter' type = "text" ng-model = "searchName" placeholder="Enter your name">
		<table id = "select-user">
			<tr> <td> {{ heads[0] }} </td> </tr>
			<tr ng-repeat="username in usernames | filter:filterByQuery(searchName)">
				<td ng-click="display(username)"> {{ username }} </td>
			</tr>
		</table>

		<table id = "selected-user" ng-hide = "selecteduser == null">
			<tr ng-repeat="(key, value) in selecteduser">
				<td>{{ key }}</td><td>{{ value }}</td>
			</tr>
		</table>


	</div>

	<script src="assets/keys/sheet-api.js" type="text/javascript"></script>
	<script src="scripts/googlesheet.js" type="text/javascript"></script>
	<script>
		var app = angular.module("hopeUNIapp", [])
		app.controller("hopeUNIctrl", 
			($scope, $http) => {

				$scope.filterByQuery = (query) => {
					return (username) => {
						return query != null && query != "" && username.toUpperCase().includes(query.toUpperCase())
					}
				}

				$scope.display = (name) => {
					return get_user_sheet(name, sheet_api)
					.then ((value) => {
						$scope.selecteduser = value
						$scope.$apply()
					})
				}


				load_sheet($http, sheet_api)
				.then ((values) => {
					$scope.heads = values["headers"]
					$scope.usernames = Object.keys(values["users"])
				})
			})
			
	</script>
</body>
</html>